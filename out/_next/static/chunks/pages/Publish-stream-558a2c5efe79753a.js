(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[182],{8126:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Publish-stream",function(){return n(1527)}])},1527:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var a=n(5893),c=n(9641);function o(){return(0,a.jsx)(c.Z,{tab:"IT-MFC | Clips"})}},2933:function(e,t,n){"use strict";n.d(t,{L:function(){return a}});let a="https://api.itmfc.ru/api"},9682:function(e,t,n){"use strict";n.d(t,{n:function(){return i}});var a=n(7066),c=n(2933);let o="".concat(c.L,"/publish"),i={getAllClips:async()=>a.Z.get("".concat(o,"/")).then(e=>e).catch(e=>e.response),getAllClipsShuffle:async()=>a.Z.get("".concat(o,"/shuffle")).then(e=>e).catch(e=>e.response),getClip:async e=>a.Z.get("".concat(o,"/clip/").concat(e)).then(e=>e).catch(e=>e.response),createClip:async e=>a.Z.post("".concat(o,"/"),e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e).catch(e=>e.response),editClip:async(e,t)=>a.Z.put("".concat(o,"/clip/").concat(e),t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e).catch(e=>e.response),removeClip:async e=>a.Z.delete("".concat(o,"/clip/").concat(e)).then(e=>e).catch(e=>e.response),checkNonstopClip:async e=>a.Z.get("".concat(o,"/nonstop/").concat(e)).then(e=>e).catch(e=>e.response),wrongClip:async e=>a.Z.put("".concat(o,"/clip/").concat(e,"/wrong")).then(e=>e).catch(e=>e.response),checkLocalClip:async e=>a.Z.get("http://localhost:3000/api/clip/".concat(e)).then(e=>e).catch(e=>e.response)}},4991:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var a=n(5893),c=n(9008),o=n.n(c);function i(e){let{children:t,tab:n}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:n}),(0,a.jsx)("meta",{name:"description",content:"Generated by create next app"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),t]})}},9641:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var a=n(5893),c=n(3967),o=n.n(c),i=n(2933),s=n(7294),l=n(9682),r=n(4991),_=n(3554),u=n.n(_),d=n(2768);function p(e){let{tab:t,area:n}=e,{downloadFile:c}=(0,d.Z)(),[_,p]=(0,s.useState)(""),[h,m]=(0,s.useState)(!0),f=e=>{p(""),console.log("rejected - ".concat(e)),location.reload()},g=()=>{m(!0),l.n.getAllClipsShuffle().then(e=>{b(0,e.data,"main")}).catch(e=>{f(e)})},b=(e,t,a)=>{m(!0),l.n.checkNonstopClip(n).then(n=>{if((null==n?void 0:n.data.length)&&"nonstop"!==a||(null==n?void 0:n.data.length)&&"nonstop"===a&&e===t.length){a="nonstop",b(0,n.data,a);return}if(!(null==n?void 0:n.data.length)&&"nonstop"==a||e===t.length&&"main"===a){g();return}p("".concat(i.L,"/file/").concat(t[e].media)),setTimeout(()=>{m(!1),console.log("play - ".concat(t[e].id)),document.querySelector("#videoClip").play().catch(n=>{console.log(n),console.log("wrong - ".concat(t[e].id)),l.n.wrongClip(t[e].id),location.reload()}),setTimeout(()=>{b(e+1,t,a)},1e3*t[e].duration),setTimeout(()=>{m(!0)},1e3*t[e].duration-500)},4e3)}).catch(e=>{f(e)})};return(0,s.useEffect)(()=>{g()},[]),(0,a.jsx)(r.Z,{tab:t,children:(0,a.jsxs)("main",{className:u().stream__container,children:[(0,a.jsx)("video",{id:"videoClip",muted:!0,src:_,className:u().stream__clip}),(0,a.jsx)("img",{src:"/images/logo.jpg",className:o()(u().stream__logo,{[u().stream__logo_show]:h})})]})})}},2768:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(7294),c=n(8767),o=n(6938),i=n(9682);let s=e=>e&&e.status>=200&&e.status<300;function l(){let[e,t]=(0,a.useState)(""),[n,l]=(0,a.useState)("Выберите файл"),[r,_]=(0,a.useState)(!1),[u,d]=(0,a.useState)(!1),{mutateAsync:p}=(0,c.useMutation)("create clip publish",e=>i.n.createClip(e).then(e=>{s(e)?(o.Rt.success("Успешно","Клип загружен на сервер."),_(!0)):(o.Rt.error("Неудача","Что-то пошло не так..."),console.log(e)),d(!1)}));return{fileSrc:e,setFileSrc:t,fileName:n,setFileName:l,isClearUpload:r,setIsClearUpload:_,isSubmit:u,createClipAsync:p,handleFile:e=>{let n=e.target.files[0],a=new FileReader;a.onloadend=e=>{t(e.target.result)},n&&(a.readAsDataURL(n),l(e.target.value.split("\\").pop()))},downloadFile:(e,t,n)=>{let a=new Blob([e],{type:n}),c=document.createElement("a");c.href=URL.createObjectURL(a),c.download=t,document.body.appendChild(c),c.click(),document.body.removeChild(c)},onCreate:e=>{localStorage.setItem("cypher",e.cypher),e={...e,expiration_date:"".concat(e.year,"-").concat(e.month,"-").concat(e.day),media:e.media[0]},d(!0),p(e)}}}},3554:function(e){e.exports={stream__container:"Publish_stream__container__4tZ05",stream__clip:"Publish_stream__clip__8El2u",stream__logo:"Publish_stream__logo__e9rV_",stream__logo_show:"Publish_stream__logo_show__Tg8Zk",form:"Publish_form__PW_Ue",field:"Publish_field__G5jWU",field__title:"Publish_field__title__g6_UW",period:"Publish_period__Zm5qn",media:"Publish_media__Jm_Yq",media__container:"Publish_media__container__GhXkF",media__caption:"Publish_media__caption__xXys8",media__image:"Publish_media__image__Gkmn6",media__fileName:"Publish_media__fileName__MewTM",submit:"Publish_submit___dPcy"}}},function(e){e.O(0,[703,888,774,179],function(){return e(e.s=8126)}),_N_E=e.O()}]);